
  # Triggers
    # Create the trigger function check_and_update_car_quantity
    op.execute("""
    CREATE OR REPLACE FUNCTION check_and_update_car_quantity()
    RETURNS TRIGGER AS $$
    BEGIN
        IF (SELECT car_quantity FROM car WHERE car_id = NEW.car_id) > 0 THEN
            UPDATE car
            SET car_quantity = car_quantity - 1
            WHERE car_id = NEW.car_id;
            RETURN NEW;
        ELSE
            RAISE EXCEPTION 'Cannot reserve car: insufficient quantity';
        END IF;
    END;
    $$ LANGUAGE plpgsql;
    """)

    # Create the trigger car_reservation_trigger
    op.execute("""
    CREATE TRIGGER car_reservation_trigger
    BEFORE INSERT ON car_reservation
    FOR EACH ROW
    EXECUTE FUNCTION check_and_update_car_quantity();
    """)

    # ### end Alembic commands ###




 # downgrading triggers
    # Drop the car_reservation_trigger trigger first
    op.execute(
        "DROP TRIGGER IF EXISTS car_reservation_trigger ON car_reservation;")

    # Drop the check_and_update_car_quantity function
    op.execute("DROP FUNCTION IF EXISTS check_and_update_car_quantity;")

    # ### end Alembic commands ###